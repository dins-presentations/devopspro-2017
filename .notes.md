# Слайды

## Положение дел на сегодня

### Микросервисная/Сервис-ориентированная архитектура - модно, молодежно
#### Описание продукта
Сферическая микросервисная ахитектура в вакууме (картинка)
    Представьте продукт своей мечты
    Задеплойте его

#### Зоопарк технологий
    Представьте продукт своей мечты
    Пишите его на чем хотите

### Стандартная команда разработки
Описание команды (картинка)
команда х10 х20 х100
Кто мы? Чего мы хотим?

### Cтандартная команда DevOps
Jenkins одмин
Чего они хотят:
    стандартный артефакт поставки для всех сервисов
    не настраивать инфраструктуру для каждого нового сервиса и технологии

### Стандартное окружение
Все хотят окружение как на PROD
Большое количество интеграционных тестов, тестировщики мудаки, думают, что чем больше, тем лучше
Разарботчикам в рамках команды достаточно одного окружения для разработки нескольких фич, 
а тестировщики хотят окружение на каждую фичу
Тербуются большие окружения для проведения регрессионного интеграционного тестирования
Большие окружения предоставленные командам для разработки и тестирования не используются в полную силу
Пример?

## Что будет если ничего не делать?
Микросервисов больше, окружение больше, релизный цикл дольше, цель дальше
Процессы СI и CD становятся сложными
Один-два CI сервера плохо справляются с ткой задачей

## Чем лечить боль
Переходим к парадигме Multi-Stage CI 
Почему? Какие проблемы решает?

## Multi-Stage CI (MSCI)
Структура (Dev - Component - Product - Global)
Делаем это по той же схеме как и переход от монолита к микросервисам!!! 

Для микросервисов у нас есть готовая инфраструктура - железо, хранилища, логгирование, мониторинг, артефакты, деплоймент. Разработчик просто конфигурит все в коде и закидывает свой сервис в готовую инфраструктуру.
То же самое надо делать и с сервером автоматизации. Как?

offtop:
Плагины
Federation, Pipiline, Job DSL

## MSCI Правильно
### Использование большого количества технологий
Проблема: Микросервисный подход это использование разных стэков технологий, и это требует поддержки на слэйвах. Они будут либо превращены в помойку, содержащую разные пакетов и версии, или наоборот будут узкоспециализированными.
Решение: Задаем конфигурацию слэйвов через Docker.
Пример

### Низкая утилизация ресурсов
Проблема: Во время релиза очередь на Jenkins постоянно занята и требует много ресурсов, а остальное время простаивают.
Решение: Используем инфраструктуру Mesos и Jenkins Mesos Plugin для динамического создания и удаление слэйвов.
Пример

### Высокая нагрузка на мастера
Проблема: Данные со слэйвов стекаются на Jenkins мастер (логи, отчеты, артефакты), поэтому производительность мастера падает. Когда что-то пошло не так на CI сервере нужны логи джобы. А если это большой регрессионный прогон, то логов может быть десятки мегабайт. Браузер тупит, поиск тупит, анализировать невозможно.  
Решение: Пишем сразу во внешние системы: логи - Elasticserach, отчеты по тестированию - объектное хранилище, артефакты - Nexus, в результатах сохраняем только ссылки.
Пример

### Один мастер для всех команд
Проблема: Использование одного Jenkins мастера неудобно когда работает множество команд (обновления мастера и плагинов, использование groovy system script (требуется согласование), всем админские права не дать)
Решение: Jenkins мастер в Docker и переносим в Mesos + Marathon (единый пул ресурсов).
Пример

### Необходимо хранить информацию о текущей конфигурации
Проблема: Необходимо сохранять конфигурацию Jenkins мастера вне Docker контейнера.
Решение: Используем объектное хранилище.
Пример

### Предоставлять окружение только в нужный момент
Проблема: Использование Docker Compose для развертывания окружения на слэйвах не красиво  по отношению к коллегам  - используя D-in-D теряем управление ресурсами.
Решение: Используем инфраструктуру Mesos + Marathon для развертывания тестовых окружений через СI.
Пример

## Итог
Подвести итог по проблемам

## Кульминация
Одна фраза, должно быть круто
